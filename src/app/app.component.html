<div class="min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <header class="mb-8 text-center">
            <img src="assets/ednue-logo.png" alt="Ednue Technologies" class="mx-auto mb-4">
            <h1 class="text-4xl font-bold text-[#ec4899] mb-2">Invoice Generator</h1>
            <p class="text-slate-500 text-lg">Ednue Trainer Portal</p>
        </header>

        <main>
            <app-trainer-details></app-trainer-details>
            <app-course-details></app-course-details>
            <app-student-details></app-student-details>
            <app-bank-details></app-bank-details>

            <div class="flex flex-col md:flex-row justify-end mt-8 mb-12 gap-6">
                <button
                    class="btn btn-secondary text-sm font-medium px-6 py-3 w-full md:w-auto shadow-sm hover:shadow rounded-full"
                    (click)="copyEmailToClipboard()" data-tooltip="Copy email content to clipboard">
                    <lucide-icon [img]="Copy" class="w-4 h-4"></lucide-icon>
                    Copy Email
                </button>
                <button
                    class="btn btn-secondary text-sm font-medium px-6 py-3 w-full md:w-auto shadow-sm hover:shadow rounded-full"
                    (click)="downloadPdf()" data-tooltip="Download invoice as PDF">
                    <lucide-icon [img]="Download" class="w-4 h-4"></lucide-icon>
                    Download PDF
                </button>
                <button
                    class="btn btn-primary text-sm font-medium px-6 py-3 w-full md:w-auto shadow-md hover:shadow-lg rounded-full"
                    (click)="generateInvoice()" data-tooltip="Generate invoice and open mail client">
                    <lucide-icon [img]="Send" class="w-4 h-4"></lucide-icon>
                    Generate & Send
                </button>
                <button *ngIf="populateDummy"
                    class="btn btn-secondary text-sm font-medium px-6 py-3 w-full md:w-auto shadow-sm hover:shadow rounded-full"
                    (click)="populateDummyData()"
                    [attr.data-tooltip]="'Add ' + dummyStudentCount + ' dummy students & fill all forms'">
                    Populate Dummy Data
                </button>
            </div>
        </main>

        <footer class="text-center text-slate-400 text-sm pb-8">
            &copy; {{ currentYear }} Ednue Technologies. All rights reserved.
        </footer>
    </div>
</div>

<!-- Print Invoice Layout -->
<div id="print-invoice" class="hidden">
    <div class="print-frame"></div>
    <div class="print-container">
        <!-- Header -->
        <div class="print-header">
            <img src="assets/ednue-logo.png" alt="Ednue Technologies" class="print-logo">
            <div class="print-title">TRAINER INVOICE</div>
            <div style="text-align: right; font-weight: bold;">{{ invoiceService.trainer().date | date:'MMMM dd, yyyy'
                }}</div>
        </div>

        <!-- From / To -->
        <div class="print-grid">
            <div>
                <div style="font-weight: bold; margin-bottom: 5px;">From:</div>
                <div>{{ invoiceService.trainer().name }}</div>
                <div>{{ invoiceService.trainer().email }}</div>
                <div>{{ invoiceService.trainer().contact }}</div>
                <div>{{ invoiceService.course().courseName }}</div>
            </div>
            <div>
                <div style="font-weight: bold; margin-bottom: 5px;">To:</div>
                <div style="font-weight: bold;">Ednue Technologies Private Limited</div>
                <div>OMR, Opposite Marina Mall, Egattur, Chennai</div>
                <div>Phone: 99622 88885 | 93637 08885</div>
                <div>Email: info@ednue.com</div>
            </div>
        </div>

        <!-- Account Details -->
        <div class="print-section-title">ACCOUNT DETAILS</div>
        <table class="print-table">
            <tr>
                <td style="width: 30%;">ACCOUNT HOLDER NAME</td>
                <td>{{ invoiceService.bank().accountHolder }}</td>
            </tr>
            <tr>
                <td>ACCOUNT NUMBER</td>
                <td>{{ invoiceService.bank().accountNumber }}</td>
            </tr>
            <tr>
                <td>IFSC CODE</td>
                <td>{{ invoiceService.bank().ifsc }}</td>
            </tr>
            <tr>
                <td>BANK NAME</td>
                <td>{{ invoiceService.bank().bankName }}</td>
            </tr>
            <tr>
                <td>BRANCH</td>
                <td>{{ invoiceService.bank().branch }}</td>
            </tr>
            <tr>
                <td>PAN</td>
                <td>{{ invoiceService.bank().pan }}</td>
            </tr>
        </table>

        <!-- Course Details -->
        <div class="print-section-title">COURSE DETAILS</div>
        <table class="print-table">
            <thead>
                <tr>
                    <th>S.NO</th>
                    <th>COURSE NAME</th>
                    <th>TOTAL STUDENTS</th>
                    <th>Price Per Head (₹)</th>
                    <th>Total Price (₹)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="center">1</td>
                    <td class="center">{{ invoiceService.course().courseName }}</td>
                    <td class="center">{{ invoiceService.course().totalStudents }}</td>
                    <td class="center">{{ invoiceService.course().pricePerStudent }}</td>
                    <td class="center">{{ invoiceService.totalAmount() | number:'1.0-0' }}</td>
                </tr>
                <tr>
                    <td colspan="4" class="text-right font-bold p-2 border-r border-gray-300">Total Amount</td>
                    <td class="font-bold p-2 text-center">{{ invoiceService.totalAmount() | number:'1.0-0' }}</td>
                </tr>
            </tbody>
        </table>

        <!-- Student Details -->
        <div class="print-section-title">STUDENT DETAILS</div>
        <table class="print-table">
            <thead>
                <tr>
                    <th>S.NO</th>
                    <th>STUDENT NAME</th>
                    <th>COURSE NAME</th>
                    <th>DURATION</th>
                    <th>START DATE</th>
                    <th>END DATE</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let student of invoiceService.students(); let i = index">
                    <td class="center">{{ i + 1 }}</td>
                    <td class="center">{{ student.name }}</td>
                    <td class="center">{{ student.courseName }}</td>
                    <td class="center">{{ student.duration }} {{ student.durationUnit | uppercase }}</td>
                    <td class="center">{{ student.startDate | date:'dd/MM/yyyy' }}</td>
                    <td class="center">{{ student.endDate | date:'dd/MM/yyyy' }}</td>
                </tr>
                <!-- Fill empty rows if needed to match look, but dynamic is better -->
                <tr *ngIf="invoiceService.students().length < 5">
                    <td class="center">&nbsp;</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr *ngIf="invoiceService.students().length < 4">
                    <td class="center">&nbsp;</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>

        <!-- Terms and Conditions -->
        <div style="margin-top: 30px; font-size: 12px;">
            <div style="font-weight: bold; margin-bottom: 5px;">TERMS AND CONDITIONS:</div>
            <ul style="padding-left: 20px; margin: 0;">
                <li>Payment will be processed only after completion of sessions and verification of attendance and
                    deliverables by Ednue.</li>
                <li>The amount payable will be based strictly on the agreed rate per student or per session, as approved
                    before training.</li>
                <li>Once payment is processed, the amount is final and no additional charges or revisions will be
                    accepted for the same engagement.</li>
                <li>Applicable statutory deductions such as TDS may apply. The trainer is responsible for compliance
                    with tax obligations.</li>
                <li>Training materials, student data, and internal information from Ednue must remain confidential and
                    must not be reused or shared without written approval.</li>
            </ul>
        </div>

        <div class="print-footer">
            (P.T.O)
        </div>
    </div>
</div>